<?xml-stylesheet type="text/xsl" href="../../../../mypy-html.xslt"?><mypy-report-file name="projects/wtp_cli/wtp_cli/utils.py" module="utils"><line any_info="No Anys on this line!" content="&quot;&quot;&quot;" number="1" precision="empty"/><line any_info="No Anys on this line!" content="Shared utilities to be used across the application" number="2" precision="empty"/><line any_info="No Anys on this line!" content="" number="3" precision="empty"/><line any_info="No Anys on this line!" content="Has functionality around" number="4" precision="empty"/><line any_info="No Anys on this line!" content="- logging" number="5" precision="empty"/><line any_info="No Anys on this line!" content="- process management" number="6" precision="empty"/><line any_info="No Anys on this line!" content="- wtp config acquisition" number="7" precision="empty"/><line any_info="No Anys on this line!" content="- opening files" number="8" precision="empty"/><line any_info="No Anys on this line!" content="&quot;&quot;&quot;" number="9" precision="empty"/><line any_info="No Anys on this line!" content="import io" number="10" precision="precise"/><line any_info="No Anys on this line!" content="import os" number="11" precision="precise"/><line any_info="No Anys on this line!" content="import pathlib" number="12" precision="precise"/><line any_info="No Anys on this line!" content="import sys" number="13" precision="precise"/><line any_info="No Anys on this line!" content="import traceback" number="14" precision="precise"/><line any_info="No Anys on this line!" content="import types" number="15" precision="precise"/><line any_info="No Anys on this line!" content="import typing" number="16" precision="precise"/><line any_info="No Anys on this line!" content="" number="17" precision="empty"/><line any_info="No Anys on this line!" content="import click" number="18" precision="precise"/><line any_info="No Anys on this line!" content="import debugpy" number="19" precision="any"/><line any_info="No Anys on this line!" content="import pyjson5" number="20" precision="precise"/><line any_info="No Anys on this line!" content="" number="21" precision="empty"/><line any_info="No Anys on this line!" content="LOG_LEVEL_COLOR_MAP = types.MappingProxyType(" number="22" precision="precise"/><line any_info="No Anys on this line!" content="    {" number="23" precision="empty"/><line any_info="No Anys on this line!" content="        &quot;success&quot;: &quot;green&quot;," number="24" precision="precise"/><line any_info="No Anys on this line!" content="        &quot;info&quot;: &quot;reset&quot;," number="25" precision="precise"/><line any_info="No Anys on this line!" content="        &quot;callout&quot;: &quot;magenta&quot;," number="26" precision="precise"/><line any_info="No Anys on this line!" content="        &quot;warning&quot;: &quot;yellow&quot;," number="27" precision="precise"/><line any_info="No Anys on this line!" content="        &quot;error&quot;: &quot;red&quot;," number="28" precision="precise"/><line any_info="No Anys on this line!" content="    }" number="29" precision="empty"/><line any_info="No Anys on this line!" content=")" number="30" precision="empty"/><line any_info="No Anys on this line!" content="" number="31" precision="empty"/><line any_info="No Anys on this line!" content="LogLevel = typing.Literal[&quot;success&quot;, &quot;info&quot;, &quot;callout&quot;, &quot;warning&quot;, &quot;error&quot;]" number="32" precision="precise"/><line any_info="No Anys on this line!" content="" number="33" precision="empty"/><line any_info="No Anys on this line!" content="" number="34" precision="empty"/><line any_info="No Anys on this line!" content="def log_message(" number="35" precision="precise"/><line any_info="No Anys on this line!" content="    msg: str," number="36" precision="empty"/><line any_info="No Anys on this line!" content="    level: LogLevel = &quot;info&quot;," number="37" precision="precise"/><line any_info="No Anys on this line!" content=") -&gt; None:" number="38" precision="empty"/><line any_info="No Anys on this line!" content="    &quot;&quot;&quot;logs a message color-coded with the option of turning off the color&quot;&quot;&quot;" number="39" precision="empty"/><line any_info="No Anys on this line!" content="" number="40" precision="empty"/><line any_info="Any Types on this line: &#10;Explicit (x3)" content="    click.echo(click.style(msg, fg=LOG_LEVEL_COLOR_MAP[level]))" number="41" precision="any"/><line any_info="No Anys on this line!" content="" number="42" precision="empty"/><line any_info="No Anys on this line!" content="" number="43" precision="empty"/><line any_info="No Anys on this line!" content="def log_exception(" number="44" precision="precise"/><line any_info="No Anys on this line!" content="    ex: Exception," number="45" precision="empty"/><line any_info="No Anys on this line!" content="    error_number: typing.Union[int, None] = None," number="46" precision="precise"/><line any_info="No Anys on this line!" content="    verbose: bool = False," number="47" precision="precise"/><line any_info="No Anys on this line!" content="    message: str = &quot;&quot;," number="48" precision="precise"/><line any_info="No Anys on this line!" content="    additional_info: str = &quot;&quot;," number="49" precision="precise"/><line any_info="No Anys on this line!" content=") -&gt; None:" number="50" precision="empty"/><line any_info="No Anys on this line!" content="    &quot;&quot;&quot;Logs an exception with optional info and can exit the process.&quot;&quot;&quot;" number="51" precision="empty"/><line any_info="No Anys on this line!" content="    if message:" number="52" precision="precise"/><line any_info="No Anys on this line!" content="        log_message(message, level=&quot;error&quot;)" number="53" precision="precise"/><line any_info="No Anys on this line!" content="" number="54" precision="empty"/><line any_info="No Anys on this line!" content="    if additional_info:" number="55" precision="precise"/><line any_info="No Anys on this line!" content="        log_message(additional_info, level=&quot;error&quot;)" number="56" precision="precise"/><line any_info="No Anys on this line!" content="" number="57" precision="empty"/><line any_info="No Anys on this line!" content="    if verbose:" number="58" precision="precise"/><line any_info="No Anys on this line!" content="        exit_code_message = &quot;&quot;" number="59" precision="precise"/><line any_info="No Anys on this line!" content="" number="60" precision="empty"/><line any_info="No Anys on this line!" content="        try:" number="61" precision="empty"/><line any_info="No Anys on this line!" content="            exit_code_message = f&quot;: exit code {error_number}&quot; if error_number else &quot;&quot;" number="62" precision="precise"/><line any_info="No Anys on this line!" content="        except AttributeError:" number="63" precision="precise"/><line any_info="No Anys on this line!" content="            pass" number="64" precision="precise"/><line any_info="No Anys on this line!" content="" number="65" precision="empty"/><line any_info="No Anys on this line!" content="        ex_traceback = traceback.format_exc()" number="66" precision="precise"/><line any_info="No Anys on this line!" content="" number="67" precision="empty"/><line any_info="No Anys on this line!" content="        log_message(&quot;Debug Info -&quot;, level=&quot;error&quot;)" number="68" precision="precise"/><line any_info="Any Types on this line: &#10;Explicit (x2)" content="        log_message(f&quot;Type: {type(ex).__name__}{exit_code_message}&quot;, level=&quot;error&quot;)" number="69" precision="precise"/><line any_info="No Anys on this line!" content="        log_message(ex_traceback, level=&quot;error&quot;)" number="70" precision="precise"/><line any_info="No Anys on this line!" content="" number="71" precision="empty"/><line any_info="No Anys on this line!" content="" number="72" precision="empty"/><line any_info="No Anys on this line!" content="def exit_process(should_log: bool = False) -&gt; None:" number="73" precision="precise"/><line any_info="No Anys on this line!" content="    &quot;&quot;&quot;End the process with an optional message.&quot;&quot;&quot;" number="74" precision="empty"/><line any_info="No Anys on this line!" content="    if should_log:" number="75" precision="precise"/><line any_info="No Anys on this line!" content="        log_message(&quot;Exiting...&quot;, level=&quot;error&quot;)" number="76" precision="precise"/><line any_info="No Anys on this line!" content="" number="77" precision="empty"/><line any_info="No Anys on this line!" content="    sys.exit(1)" number="78" precision="precise"/><line any_info="No Anys on this line!" content="" number="79" precision="empty"/><line any_info="No Anys on this line!" content="" number="80" precision="empty"/><line any_info="No Anys on this line!" content="def wtp_workspace_root(current_path_location: str) -&gt; str:" number="81" precision="precise"/><line any_info="No Anys on this line!" content="    &quot;&quot;&quot;Returns the directory that contains the We The Party workspace configuration file&quot;&quot;&quot;" number="82" precision="empty"/><line any_info="No Anys on this line!" content="    dir_contents = os.listdir(current_path_location)" number="83" precision="precise"/><line any_info="No Anys on this line!" content="" number="84" precision="empty"/><line any_info="No Anys on this line!" content="    if &quot;.wtprc&quot; in dir_contents:" number="85" precision="precise"/><line any_info="No Anys on this line!" content="        # check that we can open the file" number="86" precision="empty"/><line any_info="Any Types on this line: &#10;Explicit (x1)" content="        with open(f&quot;{current_path_location}/.wtprc&quot;, encoding=&quot;utf8&quot;):" number="87" precision="precise"/><line any_info="No Anys on this line!" content="            return current_path_location" number="88" precision="precise"/><line any_info="No Anys on this line!" content="" number="89" precision="empty"/><line any_info="No Anys on this line!" content="    if current_path_location != &quot;/&quot;:" number="90" precision="precise"/><line any_info="Any Types on this line: &#10;Explicit (x1)" content="        current_path = pathlib.Path(current_path_location)" number="91" precision="precise"/><line any_info="No Anys on this line!" content="        parent_dir_path = os.path.abspath(current_path.parent.absolute())" number="92" precision="precise"/><line any_info="No Anys on this line!" content="" number="93" precision="empty"/><line any_info="No Anys on this line!" content="        os.chdir(parent_dir_path)" number="94" precision="precise"/><line any_info="No Anys on this line!" content="" number="95" precision="empty"/><line any_info="No Anys on this line!" content="        return wtp_workspace_root(parent_dir_path)" number="96" precision="precise"/><line any_info="No Anys on this line!" content="" number="97" precision="empty"/><line any_info="No Anys on this line!" content="    return &quot;&quot;" number="98" precision="precise"/><line any_info="No Anys on this line!" content="" number="99" precision="empty"/><line any_info="No Anys on this line!" content="" number="100" precision="empty"/><line any_info="No Anys on this line!" content="def open_json_file(" number="101" precision="precise"/><line any_info="No Anys on this line!" content="    path: str, should_exit: bool = False, verbose: bool = False" number="102" precision="precise"/><line any_info="No Anys on this line!" content=") -&gt; typing.Dict[str, object]:" number="103" precision="empty"/><line any_info="No Anys on this line!" content="    &quot;&quot;&quot;Opens a JSON file with file not found and JSON parse error handling&quot;&quot;&quot;" number="104" precision="empty"/><line any_info="No Anys on this line!" content="" number="105" precision="empty"/><line any_info="Any Types on this line: &#10;Error (x6)" content="    @with_load_json(path=path, should_exit=should_exit, verbose=verbose)" number="106" precision="precise"/><line any_info="Any Types on this line: &#10;Error (x6)" content="    @with_file_not_found(path=path, should_exit=should_exit, verbose=verbose)" number="107" precision="precise"/><line any_info="No Anys on this line!" content="    def open_file(inner_path: str) -&gt; io.TextIOWrapper:" number="108" precision="precise"/><line any_info="Any Types on this line: &#10;Explicit (x1)" content="        return open(inner_path, encoding=&quot;utf-8&quot;)" number="109" precision="precise"/><line any_info="No Anys on this line!" content="" number="110" precision="empty"/><line any_info="Any Types on this line: &#10;Error (x2)" content="    return open_file(path)" number="111" precision="any"/><line any_info="No Anys on this line!" content="" number="112" precision="empty"/><line any_info="No Anys on this line!" content="" number="113" precision="empty"/><line any_info="Any Types on this line: &#10;Error (x3)" content="def with_file_not_found(" number="114" precision="precise"/><line any_info="No Anys on this line!" content="    path: str = &quot;&quot;," number="115" precision="precise"/><line any_info="No Anys on this line!" content="    should_exit: bool = False," number="116" precision="precise"/><line any_info="No Anys on this line!" content="    verbose: bool = False," number="117" precision="precise"/><line any_info="No Anys on this line!" content="    additional_info: str = &quot;&quot;," number="118" precision="precise"/><line any_info="No Anys on this line!" content=") -&gt; typing.Callable:" number="119" precision="empty"/><line any_info="No Anys on this line!" content="    &quot;&quot;&quot;" number="120" precision="empty"/><line any_info="No Anys on this line!" content="    A decorator that tries to open a file. On exception, can also optionally log" number="121" precision="empty"/><line any_info="No Anys on this line!" content="    detailed error information and exit the process" number="122" precision="empty"/><line any_info="No Anys on this line!" content="    &quot;&quot;&quot;" number="123" precision="empty"/><line any_info="No Anys on this line!" content="" number="124" precision="empty"/><line any_info="No Anys on this line!" content="    def decorator(func):" number="125" precision="any"/><line any_info="No Anys on this line!" content="        def wrapper(*args, **kw):" number="126" precision="any"/><line any_info="No Anys on this line!" content="            try:" number="127" precision="empty"/><line any_info="Any Types on this line: &#10;Unannotated (x4)" content="                return func(*args, **kw)" number="128" precision="any"/><line any_info="No Anys on this line!" content="            except FileNotFoundError as ex:" number="129" precision="precise"/><line any_info="No Anys on this line!" content="                log_exception(" number="130" precision="precise"/><line any_info="No Anys on this line!" content="                    ex," number="131" precision="precise"/><line any_info="No Anys on this line!" content="                    verbose=verbose," number="132" precision="precise"/><line any_info="No Anys on this line!" content="                    message=f&quot;ERROR: '{path}' not found&quot;," number="133" precision="any"/><line any_info="No Anys on this line!" content="                    additional_info=additional_info," number="134" precision="precise"/><line any_info="No Anys on this line!" content="                    error_number=ex.errno," number="135" precision="precise"/><line any_info="No Anys on this line!" content="                )" number="136" precision="empty"/><line any_info="No Anys on this line!" content="" number="137" precision="empty"/><line any_info="No Anys on this line!" content="                if should_exit:" number="138" precision="precise"/><line any_info="No Anys on this line!" content="                    exit_process(should_log=True)" number="139" precision="any"/><line any_info="No Anys on this line!" content="" number="140" precision="empty"/><line any_info="No Anys on this line!" content="            return None" number="141" precision="any"/><line any_info="No Anys on this line!" content="" number="142" precision="empty"/><line any_info="Any Types on this line: &#10;Unannotated (x3)" content="        return wrapper" number="143" precision="precise"/><line any_info="No Anys on this line!" content="" number="144" precision="empty"/><line any_info="Any Types on this line: &#10;Unannotated (x2)" content="    return decorator" number="145" precision="precise"/><line any_info="No Anys on this line!" content="" number="146" precision="empty"/><line any_info="No Anys on this line!" content="" number="147" precision="empty"/><line any_info="Any Types on this line: &#10;Error (x3)" content="def with_load_json(" number="148" precision="precise"/><line any_info="No Anys on this line!" content="    path: str = &quot;&quot;," number="149" precision="precise"/><line any_info="No Anys on this line!" content="    should_exit: bool = False," number="150" precision="precise"/><line any_info="No Anys on this line!" content="    verbose: bool = False," number="151" precision="precise"/><line any_info="No Anys on this line!" content="    additional_info: str = &quot;&quot;," number="152" precision="precise"/><line any_info="No Anys on this line!" content=") -&gt; typing.Callable:" number="153" precision="empty"/><line any_info="No Anys on this line!" content="    &quot;&quot;&quot;" number="154" precision="empty"/><line any_info="No Anys on this line!" content="    A decorator that serializes JSON from a file. On exception, can also optionally" number="155" precision="empty"/><line any_info="No Anys on this line!" content="    log detailed error information and exit the process" number="156" precision="empty"/><line any_info="No Anys on this line!" content="    &quot;&quot;&quot;" number="157" precision="empty"/><line any_info="No Anys on this line!" content="" number="158" precision="empty"/><line any_info="No Anys on this line!" content="    def decorator(func):" number="159" precision="any"/><line any_info="No Anys on this line!" content="        def wrapper(*args, **kw):" number="160" precision="any"/><line any_info="No Anys on this line!" content="            try:" number="161" precision="empty"/><line any_info="Any Types on this line: &#10;Explicit (x2)&#10;Unannotated (x4)" content="                return pyjson5.decode_io(func(*args, **kw))" number="162" precision="any"/><line any_info="Any Types on this line: &#10;Explicit (x1)" content="            except pyjson5.Json5Exception as ex:" number="163" precision="precise"/><line any_info="No Anys on this line!" content="                log_exception(" number="164" precision="precise"/><line any_info="No Anys on this line!" content="                    ex," number="165" precision="precise"/><line any_info="No Anys on this line!" content="                    verbose=verbose," number="166" precision="precise"/><line any_info="No Anys on this line!" content="                    message=f&quot;ERROR: parsing JSON from '{path}' failed&quot;," number="167" precision="any"/><line any_info="No Anys on this line!" content="                    additional_info=additional_info," number="168" precision="precise"/><line any_info="No Anys on this line!" content="                )" number="169" precision="empty"/><line any_info="No Anys on this line!" content="" number="170" precision="empty"/><line any_info="No Anys on this line!" content="                if should_exit:" number="171" precision="precise"/><line any_info="No Anys on this line!" content="                    exit_process(should_log=True)" number="172" precision="any"/><line any_info="No Anys on this line!" content="" number="173" precision="empty"/><line any_info="No Anys on this line!" content="            return None" number="174" precision="any"/><line any_info="No Anys on this line!" content="" number="175" precision="empty"/><line any_info="Any Types on this line: &#10;Unannotated (x3)" content="        return wrapper" number="176" precision="precise"/><line any_info="No Anys on this line!" content="" number="177" precision="empty"/><line any_info="Any Types on this line: &#10;Unannotated (x2)" content="    return decorator" number="178" precision="precise"/><line any_info="No Anys on this line!" content="" number="179" precision="empty"/><line any_info="No Anys on this line!" content="" number="180" precision="empty"/><line any_info="Any Types on this line: &#10;Unannotated (x1)&#10;Error (x3)" content="def with_debug(func) -&gt; typing.Callable:" number="181" precision="any"/><line any_info="No Anys on this line!" content="    &quot;&quot;&quot;" number="182" precision="empty"/><line any_info="No Anys on this line!" content="    Prints a debug message and runs debugpy, which will wait for a debugger" number="183" precision="empty"/><line any_info="No Anys on this line!" content="    to connect on the given port" number="184" precision="empty"/><line any_info="No Anys on this line!" content="    &quot;&quot;&quot;" number="185" precision="empty"/><line any_info="No Anys on this line!" content="" number="186" precision="empty"/><line any_info="No Anys on this line!" content="    def wrapper(*args, **kw):" number="187" precision="any"/><line any_info="Any Types on this line: &#10;Unannotated (x3)" content="        if kw[&quot;debug&quot;] and os.environ.get(&quot;WTP_DEBUG&quot;) is None:" number="188" precision="any"/><line any_info="No Anys on this line!" content="            log_message(&quot;Debugging...&quot;, level=&quot;callout&quot;)" number="189" precision="any"/><line any_info="Any Types on this line: &#10;Unannotated (x2)" content="            log_message(f&quot;Port - {kw['port']}&quot;, level=&quot;callout&quot;)" number="190" precision="any"/><line any_info="No Anys on this line!" content="" number="191" precision="empty"/><line any_info="No Anys on this line!" content="            os.environ[&quot;WTP_DEBUG&quot;] = &quot;&quot;" number="192" precision="any"/><line any_info="No Anys on this line!" content="" number="193" precision="empty"/><line any_info="Any Types on this line: &#10;Unimported (x3)&#10;Unannotated (x2)" content="            debugpy.listen((&quot;localhost&quot;, kw[&quot;port&quot;]))" number="194" precision="any"/><line any_info="Any Types on this line: &#10;Unimported (x3)" content="            debugpy.wait_for_client()" number="195" precision="any"/><line any_info="No Anys on this line!" content="" number="196" precision="empty"/><line any_info="Any Types on this line: &#10;Unannotated (x4)" content="        return func(*args, **kw)" number="197" precision="any"/><line any_info="No Anys on this line!" content="" number="198" precision="empty"/><line any_info="Any Types on this line: &#10;Unannotated (x3)" content="    return wrapper" number="199" precision="precise"/></mypy-report-file>